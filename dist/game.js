/*! missilewar 18-04-2015 */
function logPlay(){_gaq.push(["_trackEvent","Button","Play"])}function start(){var a=new Date;window.app=new SL.Game({canvas:document.getElementById("GameCanvas")}),app.fullscreen(),app.assetCollection=new SL.AssetCollection("res/assets.json",app,function(){_gaq.push(["_trackEvent","Game","Load","",(new Date-a)/1e3]),$(".canvas-container").append(domjs.build(templates.modal));var b=new SL.Scene("loading",[],function(){},app);b.addEntity(new SL.Loader({assetCollection:app.assetCollection,screenSize:SCREEN_SIZE,loadCallback:function(){app.transitionScene("menu")},barColor:"blue",textColor:"green"}));var c=new SL.Scene("menu",[],function(){var a=$(".modal");a.append(domjs.build(templates.menu)),$(".menu .button").on("click",function(){a.empty(),a.off(),app.transitionScene($(this).attr("id"))})},app),d=new SL.Scene("game",[],function(){var a=$(".modal");a.empty(),a.off(),a.hide(),app.currentScene.addEntity({type:"background",sprite:new PIXI.Sprite(app.assetCollection.getTexture("background")),update:function(){}}),app.currentScene.addEntity(new Player)},app),e=new SL.Scene("score",[],function(){var a=$(".modal");a.append(domjs.build(templates.score)),a.show(),$(".menu .button").on("click",function(){a.empty(),a.off(),app.transitionScene($(this).attr("id"))})},app);app.addScene(b),app.addScene(c),app.addScene(d),app.addScene(e),app.transitionScene("loading"),app.start()})}function Tile(a){var b=this;b.sprite=new PIXI.Sprite(app.assetCollection.getTexture("tile")),b.sprite.position=a.position.clone(),b.tag="tile",b.collider=new SL.Rect(a.position,TILE_SIZE),b.ship=a.ship,b.building=null,b.state="idle",b.update=function(){b.sprite.setTexture("active"===b.state?app.assetCollection.getTexture("tile-active"):app.assetCollection.getTexture("tile")),b.state="idle"}}function Building(a){var b=this;b.sprite=new PIXI.Sprite(app.assetCollection.getTexture("tile")),b.sprite.position=a.position.clone(),b.tag="building",b.ship=a.ship,b.tile=a.tile,b.update=function(){}}function Ship(a){var b=this,c=app.assetCollection.assets.ships[a.type];b.tag="ship",b.type=a.type,b.maxShield=SHIP_INITIAL_MAX_SHIELD,b.shield=b.maxShield,b.buildings=a.buildings||[],b.tiles=a.tiles||[],b.corePosition=a.position.clone();for(var d=0;d<c.length;d++)b.tiles.push(new Tile({position:a.position.getTranslated(new SL.Vec2(c[d].x*TILE_SIZE.x,c[d].y*TILE_SIZE.y)),ship:b})),app.currentScene.addEntity(b.tiles[d])}function Player(){var a=this;a.update=function(){for(var a=new SL.Rect(app.mouseLocation,new SL.Vec2(1,1)),b=app.currentScene.getEntitiesByTag("tile"),c=0;c<b.length;c++)a.intersects(b[c].collider)&&(b[c].state="active")}}function makeShip(a){new Ship({position:a.position,type:"basic"})}SL=sugarLab;var SCREEN_SIZE=new SL.Vec2(document.documentElement.clientWidth,document.documentElement.clientHeight),TILE_SIZE=new SL.Vec2(64,64),COLLIDER_SIZE=64,SHIP_INITIAL_MAX_SHIELD=100;