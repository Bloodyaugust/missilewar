/*! missilewar 07-04-2015 */
function logPlay(){_gaq.push(["_trackEvent","Button","Play"])}function moveModal(){var a=$(".modal"),b=$(app.canvas).offset();a.offset({top:b.top-5,left:b.left-5})}function start(){var a=new Date;window.app=new SL.Game({canvas:document.getElementById("GameCanvas")}),app.assetCollection=new SL.AssetCollection("res/assets.json",app,function(){_gaq.push(["_trackEvent","Game","Load","",(new Date-a)/1e3]),$(".canvas-container").append(domjs.build(templates.modal)),moveModal(),$(window).resize(function(){moveModal()});var b=new SL.Scene("loading",[],function(){},app);b.addEntity(new SL.Loader({assetCollection:app.assetCollection,screenSize:SCREEN_SIZE,loadCallback:function(){app.transitionScene("menu")},barColor:"blue",textColor:"green"}));var c=new SL.Scene("menu",[],function(){var a=$(".modal");a.append(domjs.build(templates.menu)),$(".menu .button").on("click",function(){a.empty(),a.off(),app.transitionScene($(this).attr("id"))})},app),d=new SL.Scene("game",[],function(){var a=$(".modal");a.empty(),a.off(),a.hide(),app.currentScene.addEntity({type:"background",sprite:new PIXI.Sprite(app.assetCollection.getTexture("background")),update:function(){}}),app.currentScene.addEntity(new Spawner),app.currentScene.addEntity(new Player)},app),e=new SL.Scene("score",[],function(a){var b=$(".modal"),c=new PIXI.Text("Score: "+a[0].score,{font:"18px Arial",fill:"red"});b.append(domjs.build(templates.score)),b.show(),$(".menu .button").on("click",function(){b.empty(),b.off(),app.transitionScene($(this).attr("id"))}),c.position.x=350,c.position.y=400,this.stage.addChild(c),$(".twitter-share-button").attr("href","https://twitter.com/share?url=http://synsugarstudio.com/ld31&hashtags=ld31,bahhumbug&text=I scored "+a[0].score+" on Bah! Humbug!")},app);app.addScene(b),app.addScene(c),app.addScene(d),app.addScene(e),app.transitionScene("loading"),app.start()})}function Caroler(a){var b=this,c=app.assetCollection.assets.carolers[a.type];b.type=a.type||"caroler",b.tag="caroler",b.sprite=new PIXI.Sprite(app.assetCollection.getTexture(a.type+"-front")),b.path=a.path,b.sprite.anchor.x=.5,b.sprite.anchor.y=.5,b.sprite.position.x=a.position.x,b.sprite.position.y=a.position.y,b.sprite.rotation=0,b.collider=new SL.Rect(a.position,new SL.Vec2(50,100)),b.apparentSize=SL.Tween.lerp(.5,1,b.collider.origin.y/SCREEN_SIZE.y),b.pathPoint=0,b.isDead=!1,b.timeToStep=.1,b.stepInterval=.1,b.stepState=0,b.collider.translate(new SL.Vec2(0,-50));for(var d in c)c.hasOwnProperty(d)&&(b[d]=c[d]);b.update=function(){var a=b.path[b.pathPoint].distance(b.collider.origin),c=b.collider.origin.getDirectionVector(b.path[b.pathPoint]),d=b.speed*app.deltaTime*b.apparentSize;if(b.isDead)app.currentScene.removeEntity(b);else{switch(b.timeToStep-=app.deltaTime,a>d?b.collider.translate(c.scale(d)):b.pathPoint===b.path.length-1?(b.isDead=!0,app.currentScene.getEntitiesByTag("player")[0].hit()):(b.collider.setLocation(b.path[b.pathPoint].getTranslated(b.collider.size.getScaled(-.5))),b.collider.translate(b.collider.origin.getDirectionVector(b.path[++b.pathPoint]).scale(d-a))),b.sprite.position.x=b.collider.origin.x,b.sprite.position.y=b.collider.origin.y,b.timeToStep<=0&&(b.timeToStep=b.stepInterval,b.stepState++,b.stepState>3&&(b.stepState=0)),b.stepState){case 0:b.sprite.rotation=-.02;break;case 2:b.sprite.rotation=.02;break;default:b.sprite.position.y+=5}b.apparentSize=SL.Tween.lerp(.5,1,b.collider.origin.y/SCREEN_SIZE.y),b.sprite.scale=new PIXI.Point(b.apparentSize,b.apparentSize),b.collider=new SL.Rect(b.collider.location,new SL.Vec2(50,100).scale(b.apparentSize))}},b.hit=function(){return b.health-=1,b.health<=0?(b.isDead=!0,b.pointValue):0}}function Spawner(){function a(){var a,b=Math.random();switch(!0){case b>=0&&.75>=b:a="caroler";break;case b>.75&&.9>=b:a="snowman";break;case b>.9&&.98>=b:a="santa";break;case b>.98&&1>=b:a="elf"}return a}var b=this;b.timeToSpawn=3,b.spawnInterval=2,b.gameTime=0,b.spawnpoints=[new SL.Vec2(-50,200),new SL.Vec2(800,200),new SL.Vec2(-50,380),new SL.Vec2(800,380)],b.paths=[[new SL.Vec2(400,200),new SL.Vec2(400,600)],[new SL.Vec2(400,200),new SL.Vec2(400,600)],[new SL.Vec2(400,380),new SL.Vec2(400,600)],[new SL.Vec2(400,380),new SL.Vec2(400,600)]],b.update=function(){var c;b.gameTime+=app.deltaTime,b.timeToSpawn-=app.deltaTime,b.spawnInterval=2-SL.Tween.quadIn(1.8,b.gameTime/240),b.timeToSpawn<=0&&(c=Math.floor(4*Math.random()),app.currentScene.addEntity(new Caroler({type:a(),position:b.spawnpoints[c],path:b.paths[c]})),b.timeToSpawn=b.spawnInterval)}}function Player(){var a=this;a.tag="player",a.score=0,a.health=10,a.clipSize=7,a.clip=a.clipSize,a.reloadTime=1,a.timeToReload=0,a.shotCooldown=.2,a.timeToShotCooldown=0,a.jitterBase=200,a.jitterRange=50,a.steady=150,a.scopeVelocity=new SL.Vec2(0,0),a.scopeOffset=new SL.Vec2(0,0),a.scopeRest=1,a.sprite=new PIXI.Sprite(app.assetCollection.getTexture("scope")),a.sprite.anchor.x=.5,a.sprite.anchor.y=.5,a.sprite.position.x=0,a.sprite.position.y=0,a.index=0,a.state="rest",a.bulletTexture=app.assetCollection.getTexture("bullet"),a.heartTexture=app.assetCollection.getTexture("heart"),a.bullets=[],a.hearts=[],a.scoreText=new PIXI.Text("Score: 0",{font:"18px Arial",fill:"red"}),a.scoreText.position.x=20,a.scoreText.position.y=550,a.update=function(){var b=app.mouseLocation.getTranslated(a.scopeOffset);if(a.scopeOffset.translate(a.scopeVelocity.getScaled(app.deltaTime)),a.scopeVelocity.scale(.9),a.scopeVelocity.magnitude()<a.scopeRest&&(a.scopeVelocity=new SL.Vec2(0,0)),"rest"===a.state){if(a.scopeOffset.magnitude()>a.steady*app.deltaTime?a.scopeOffset.translate(a.scopeOffset.getNormal().scale(-1*a.steady*app.deltaTime)):a.scopeOffset=new SL.Vec2(0,0),app.onMouseDown("left")){var c=new SL.Rect(b,new SL.Vec2(1,1)),d=app.currentScene.getEntitiesByTag("caroler"),e=new SL.Vec2(a.jitterRange/2,a.jitterRange/2).randomize(),f=Math.random();e.translate(new SL.Vec2(a.jitterBase,a.jitterBase)),.25>f?e.x*=-1:.5>f?e.y*=-1:.75>f&&e.scale(-1),a.scopeVelocity.translate(e);for(var g=0;g<d.length;g++)if(c.intersects(d[g].collider)){a.score+=d[g].hit(),a.scoreText.setText("Score: "+a.score),"elf"===d[g].type&&(a.health++,addHeart());break}a.clip--,0===a.clip?(a.state="reloading",a.timeToReload=a.reloadTime):(a.state="cooldown",a.timeToShotCooldown=a.shotCooldown),removeBullet()}}else if("cooldown"===a.state&&(a.timeToShotCooldown-=app.deltaTime,a.timeToShotCooldown<=0&&(a.state="rest")),"reloading"===a.state&&(a.timeToReload-=app.deltaTime,a.timeToReload<=0)){a.state="rest",a.clip=a.clipSize,a.timeToReload=a.reloadTime;for(var g=0;g<a.clip;g++)addBullet()}app.currentScene.stage.setChildIndex(a.sprite,app.currentScene.stage.children.length-1),a.sprite.position.x=b.x,a.sprite.position.y=b.y},a.hit=function(){a.health-=1,removeHeart(),a.health<1&&app.transitionScene("score",[{score:a.score,type:"score"}])},addBullet=function(){var b=new PIXI.Sprite(a.bulletTexture);b.anchor.x=.5,b.anchor.y=.5,b.position.x=15+15*a.bullets.length,b.position.y=500,a.bullets.push(b),app.currentScene.stage.addChild(b)},addHeart=function(){var b=new PIXI.Sprite(a.heartTexture);b.anchor.x=.5,b.anchor.y=.5,b.position.x=768-35*(a.hearts.length%5),b.position.y=500+32*Math.floor(a.hearts.length/5),a.hearts.push(b),app.currentScene.stage.addChild(b)},removeBullet=function(){app.currentScene.stage.removeChild(a.bullets[a.bullets.length-1]),a.bullets.pop()},removeHeart=function(){app.currentScene.stage.removeChild(a.hearts[a.hearts.length-1]),a.hearts.pop()};for(var b=0;b<a.clip;b++)addBullet();for(b=0;b<a.health;b++)addHeart();app.currentScene.stage.addChild(a.scoreText)}SL=sugarLab;var SCREEN_SIZE=new SL.Vec2(800,600);